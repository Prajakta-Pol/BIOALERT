<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doctor Dashboard - BioMediAlert</title>
   <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #dbeafe, #e3f2fd, #f5f9ff);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .glass {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.4);
    }

    .profile-photo-container {
  width: 120px; 
  height: 120px;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #4f46e5; /* Optional border */
  display: flex;
  justify-content: center;
  align-items: center;
}

.profile-photo-container img {
  width: 100%;
  height: 100%;
  object-fit: cover; /* VERY IMPORTANT */
}


    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade { animation: fadeIn 0.7s ease-in-out; }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .floating { animation: float 6s ease-in-out infinite; }
  </style>
</head>

<body class="relative text-gray-800">
  <!-- Floating Gradient Orbs -->
  <div class="absolute w-[400px] h-[400px] bg-blue-400/20 rounded-full blur-3xl top-10 left-6 floating"></div>
  <div class="absolute w-[350px] h-[350px] bg-teal-400/20 rounded-full blur-3xl bottom-10 right-6 floating"></div>

  <!-- Navbar -->


  <nav class="glass flex flex-wrap justify-between items-center px-6 md:px-10 py-4 shadow-md sticky top-0 z-20 border-b border-white/40">
  

  <a href="dashboard.html">
    <div class="text-2xl font-bold text-[#0a3d62] hover:scale-105 transition-transform duration-300">
      BioMediAlert
    </div>
  </a>

  <ul class="flex flex-wrap items-center space-x-4 md:space-x-8 text-[#0a3d62] font-medium mt-3 md:mt-0">
    <li>
      <button onclick="openSearchOptions()" 
        class="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-full shadow-md hover:scale-105 transition">
        Search Patient
      </button>
    </li>

    <li>
      <a href="doctorlogin.html" onclick="logout()" class="hover:text-blue-600 transition">
        Logout
      </a>
    </li>
  </ul>
</nav>



  <!-- Welcome Card -->
  <section class="flex justify-center mt-12 animate-fade">
    <div class="glass flex flex-col md:flex-row items-center gap-6 p-6 md:p-8 rounded-2xl shadow-lg w-[90%] max-w-3xl border border-white/50 hover:shadow-2xl transition-all duration-300">
       <!-- Doctor Profile Photo -->
        <div class="profile-photo-container">
    <img id="doctorPhoto" src="" alt="Doctor Photo">
</div>

      
      <div>
        <h2 class="text-3xl font-semibold text-[#0a3d62]">Welcome, Doctor üë®‚Äç‚öïÔ∏è</h2>
        <p class="text-gray-600 mt-2 text-lg">Search for patient records or manage your logs below.</p>
      </div>
    </div>
  </section>

  <!-- Search Result Box -->
  <div id="searchResult" class="glass mx-auto mt-10 p-6 rounded-2xl shadow-lg w-[90%] max-w-3xl text-center hidden animate-fade">
    <p class="text-gray-600 text-lg" id="resultMsg">No results yet...</p>
  </div>

  <!-- Info Section -->
  <section class="mx-auto mt-14 px-6 md:px-16 max-w-5xl animate-fade">
    <h2 class="text-3xl font-bold text-[#0a3d62] mb-3">Doctor Dashboard</h2>
    <p class="text-gray-700 mb-6 text-lg">Access and manage patient data securely.</p>

    <div class="grid md:grid-cols-2 gap-6">
      <!-- Card 1 -->
      <div class="glass rounded-2xl p-6 shadow-md hover:shadow-xl transition duration-300 border border-white/50">
        <h3 class="text-xl font-semibold text-[#0a3d62] mb-2">üßæ Patient Logs</h3>
        <p class="text-gray-600 mb-4">View all patients you've treated and their medical summaries.</p>
        <a href="doctorLogs.html" class="bg-[#0a3d62] hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium shadow-md transition-all duration-300">Go to Logs</a>
      </div>

      <!-- Card 2 -->
      <div class="glass rounded-2xl p-6 shadow-md hover:shadow-xl transition duration-300 border border-white/50">
        <h3 class="text-xl font-semibold text-[#0a3d62] mb-2">üë§ My Profile</h3>
        <p class="text-gray-600 mb-4">Update your doctor details and credentials anytime.</p>
        <a href="doctorprofile.html" class="bg-[#0a3d62] hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium shadow-md transition-all duration-300">View Profile</a>
      </div>
    </div>
  </section>
<!-- Search Options Modal -->
<div id="searchModal" class="fixed inset-0 bg-black/40 flex justify-center items-center hidden z-50">
  <div class="glass p-6 rounded-2xl w-[90%] max-w-md text-center shadow-xl border border-white/50">

    <h2 class="text-2xl font-semibold mb-4 text-[#0a3d62]">Choose Search Method</h2>

    <select id="searchType" 
      class="w-full p-3 rounded-lg border border-gray-300 mb-4">
      <option value="">Select Method</option>
      <option value="aadhaar">Aadhaar Card Number</option>
      <option value="pancard">PAN Card Number</option>
      <option value="emergency">Emergency ID</option>
      <option value="license">Driving License Number</option>
      
    </select>
<!-- ‚úÖ NEW: REASON DROPDOWN -->
    <select id="searchReason" class="w-full p-3 rounded-lg border border-gray-300 mb-4">
      <option value="">Select Reason</option>
      <option value="emergency">üö® Emergency - Accident/Unconscious</option>
      <option value="critical">‚ö†Ô∏è Critical Condition</option>
      <option value="life_threatening">üíÄ Life-threatening</option>
    </select>
    
    <input 
      id="searchValue"
      type="text"
      placeholder="Enter ID number..."
      class="w-full p-3 rounded-lg border border-gray-300 mb-4 hidden"
    />
    <p id="modalMessage" class="text-lg font-medium mb-3 hidden"></p>
    <button onclick="processSearch()" 
      class="bg-blue-600 text-white px-5 py-2.5 rounded-lg w-full hover:bg-blue-700 transition">
      Continue
    </button>

    <button onclick="closeSearchOptions()" 
      class="mt-3 text-red-600 hover:underline">
      Cancel
    </button>
  </div>
</div>

  <!-- Footer -->
  <footer class="mt-16 text-center py-6 bg-[#0a3d62] text-white shadow-inner">
    <p class="text-sm opacity-90">¬© 2025 <span class="font-semibold">BioMediAlert</span> ‚Äî All Rights Reserved</p>
  </footer>

  <script>
    function openSearchOptions() {
      document.getElementById("searchModal").classList.remove("hidden");
      document.getElementById("modalMessage").classList.add("hidden");
    }

    function closeSearchOptions() {
      document.getElementById("searchModal").classList.add("hidden");
    }

    document.getElementById("searchType").addEventListener("change", function () {
      const type = this.value;
      const input = document.getElementById("searchValue");

      if (type === "") {
        input.classList.add("hidden");
      } else {
        input.classList.remove("hidden");
        input.placeholder = "Enter " + this.options[this.selectedIndex].text;
      }
    });

    async function processSearch() {
      const type = document.getElementById("searchType").value;
      const value = document.getElementById("searchValue").value.trim();
      const reason = document.getElementById("searchReason").value;

      if (!type || !value|| !reason) {
        showResult("‚ùå Please select method, enter value, AND choose reason!", false);
        return;
      }

    // Map your HTML values to backend values
      const searchData = {
        access_method: type,  // "emergency", "pancard", "license", "aadhaar"
        reason:reason // Fixed for now
      };

  // Map input to correct field name
      if (type === "aadhaar") searchData.aadhaar = value;
      else if (type === "pancard") searchData.pan = value;
      else if (type === "license") searchData.license = value;
      else if (type === "emergency") searchData.emergencyId = value;

      try {
        const res = await fetch("http://127.0.0.1:5037/api/doctor/search_patient", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(searchData)
        });

        const data = await res.json();
        console.log("‚úÖ Search data:", searchData);
        console.log("‚úÖ Response:", data);

        if (res.ok && data.success) {
      // Show blockchain status first!
          showResult(
            `‚úÖ <b>Patient:</b> ${data.patient.Fullname}<br>
            üìÑ <b>Status:</b> ${data.blockchain_status}`,
            true
          );
          setTimeout(() => {
            closeSearchOptions();
          // Encode Aadhaar
          const encodedAadhaar = btoa(data.patient.aadhaar);

        // Redirect with encoded value
          window.location.href = `PatientView.html?aadhaar=${encodedAadhaar}`;
          },500);
        } else {
            showResult("‚ùå " + (data.message || "Patient not found!"), false);
        }

      } catch (err) {
        console.error("Search error:", err);
        showResult("‚ùå Server error - check Flask & Ganache!", false);
      }
    }
    function showResult(message, success) {
      //const box = document.getElementById("searchResult");
      //const msg = document.getElementById("resultMsg");
      const msg = document.getElementById("modalMessage");

      msg.innerHTML = message;
      msg.className = success
        ? "text-green-700 text-lg font-medium mb-3"
        : "text-red-600 text-lg font-medium mb-3";

      //box.classList.remove("hidden");
      msg.classList.remove("hidden");
    }

    //function loadDoctorProfile() {
      //fetch("http://127.0.0.1:5037/api/doctor/profile")
      //.then(res => res.json())
      //.then(data => {
      //if (data.success) {
        //document.getElementById("doctorPhoto").src =
          //"http://127.0.0.1:5037/uploads/" + data.photo;
      //}
    //});
//}


    async function loadDoctorDashboardProfile() {
      try {
          const res = await fetch("http://127.0.0.1:5037/api/doctor/details");
          const data = await res.json();

      if(res.ok) {
        if (data.photo) {
        document.getElementById("doctorPhoto").src = "http://127.0.0.1:5037" + data.photo;
      }

      // Optional: update name instead of ‚ÄúWelcome, Doctor‚Äù
      if (data.Fullname) {
        document.querySelector("h2.text-3xl").textContent = `Welcome, Dr. ${data.Fullname}`;
        
      }
      if (data.hospitalName) {
        
      }
    }
  } catch (err) {
    console.error("Doctor profile load error:", err);
  }
}
  loadDoctorDashboardProfile();

  
    function logout() {
      localStorage.removeItem("currentDoctor");
      
      window.location.href = "dashboard.html";
    }
  </script>
</body>
</html>