<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Access Logs - BioMediAlert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #dbeafe, #e3f2fd, #f5f9ff);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.7s ease-in-out; }
    </style>
</head>
<body class="p-6 md:p-12">
    <!-- Navbar -->
    <nav class="glass flex justify-between items-center px-6 py-4 rounded-2xl shadow-lg mb-8 sticky top-4 z-20">
        <div class="text-2xl font-bold text-[#0a3d62]">BioMediAlert</div>
        <a href="PatientDS.html" class="bg-[#0a3d62] text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">‚Üê Back</a>
    </nav>

    <!-- Header -->
    <div class="text-center mb-12 animate-fade">
        <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-[#0a3d62] to-blue-600 bg-clip-text text-transparent mb-4">
            üìã Access Logs
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Monitor who accessed your emergency data and verify blockchain integrity
        </p>
    </div>

    <!-- Logs Container -->
    <div class="glass max-w-6xl mx-auto p-8 rounded-3xl shadow-2xl animate-fade">
        <!-- Loading -->
        <div id="loadingSpinner" class="text-center py-12 hidden">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-600">Loading access logs...</p>
        </div>

        <!-- Table -->
        <div id="logsContainer" class="overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full table-auto" id="logsTable">
                    <thead class="bg-gradient-to-r from-[#0a3d62] to-blue-600 text-white sticky top-0">
                        <tr>
                            <th class="p-6 text-left font-semibold rounded-tl-2xl">üë®‚Äç‚öïÔ∏è Doctor</th>
                            <th class="p-6 text-left font-semibold">üìÖ Date & Time</th>
                            <th class="p-6 text-left font-semibold">üîç Method</th>
                            <th class="p-6 text-left font-semibold">üö® Reason</th>
                            <th class="p-6 text-left font-semibold rounded-tr-2xl">üîó Blockchain</th>
                        </tr>
                    </thead>
                    <tbody id="logsBody" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="5" class="text-center py-12 text-gray-500">
                                <div class="animate-pulse">Loading your logs...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- No logs message -->
            <div id="noLogs" class="text-center py-20 text-gray-500 hidden">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-green-600 mb-2">No Unauthorized Access</h3>
                <p class="text-lg">Your emergency data has not been accessed by any doctors.</p>
            </div>
        </div>
    </div>

    <script>
        async function loadPatientLogs() {
            const spinner = document.getElementById('loadingSpinner');
            const container = document.getElementById('logsContainer');
            
            spinner.classList.remove('hidden');
            
            try {
                const res = await fetch('http://127.0.0.1:5037/getPatientLogs');  // YOUR ENDPOINT
                const data = await res.json();
                
                const tbody = document.getElementById('logsBody');
                const noLogs = document.getElementById('noLogs');
                
                console.log("üìä Logs loaded:", data.logs.length, "entries");
                
                if (data.logs && data.logs.length === 0) {
                    tbody.innerHTML = '';
                    noLogs.classList.remove('hidden');
                } else if (data.logs && data.logs.length > 0) {
                    noLogs.classList.add('hidden');
                    tbody.innerHTML = data.logs.map((log, index) => `
                        <tr class="hover:bg-blue-50 hover:shadow-md transition-all duration-200 ${index % 2 === 0 ? 'bg-gray-50' : ''}">
                            <td class="p-6 font-semibold text-gray-900">
                                ${log.doctorName || 'Unknown Doctor'}
                            </td>
                            <td class="p-6 text-gray-700">
                                ${log.date || 'N/A'}<br>
                                <span class="text-sm text-gray-500">${log.time || 'N/A'}</span>
                            </td>
                            <td class="p-6">
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium 
                                    bg-blue-100 text-blue-800 border border-blue-200">
                                    ${log.access_method?.toUpperCase() || 'N/A'}
                                </span>
                            </td>
                            <td class="p-6">
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold
                                    ${log.reason === 'emergency' ? 'bg-red-100 text-red-800 border border-red-200' : 
                                      log.reason === 'critical' ? 'bg-orange-100 text-orange-800 border border-orange-200' : 
                                      'bg-purple-100 text-purple-800 border border-purple-200'}">
                                    ${log.reason || 'N/A'}
                                </span>
                            </td>
                            <td class="p-6 font-medium">
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold
                                    ${log.blockchain_status?.includes('‚úÖ') ? 'bg-green-100 text-green-800 border border-green-200' : 
                                      'bg-yellow-100 text-yellow-800 border border-yellow-200'}">
                                    ${log.blockchain_status || 'üìã Database'}
                                </span>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (err) {
                console.error('‚ùå Logs error:', err);
                document.getElementById('logsBody').innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-12 text-red-500">
                            <div class="text-2xl mb-2">‚ö†Ô∏è</div>
                            Error loading logs. Please try again.
                        </td>
                    </tr>
                `;
            } finally {
                spinner.classList.add('hidden');
            }
        }

        // Auto-load on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadPatientLogs);
        } else {
            loadPatientLogs();
        }
    </script>
</body>
</html>
